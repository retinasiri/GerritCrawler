require('dotenv').config()
const fs = require('fs')
const dumpCollectionAsCSV = require('./index')
const filePath = './dump.csv'

describe('Dump Mongo`s collection to CSV', () => {
    test('Env var MONGO_URL should be present', () => expect(process.env.MONGO_URL).toBeTruthy())
    test('Env var COLLECTION_NAME should be present', () => expect(process.env.COLLECTION_NAME).toBeTruthy())
    test('It should download content to root path as dump.csv', async () => {
        const mongoConnectionString = process.env.MONGO_URL
        const collectionName = process.env.COLLECTION_NAME

        await dumpCollectionAsCSV({ mongoConnectionString, collectionName })

        expect(fs.existsSync(filePath)).toBeTruthy()
    })
})